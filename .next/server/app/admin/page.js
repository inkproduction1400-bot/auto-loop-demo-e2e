(()=>{var e={};e.id=3,e.ids=[3],e.modules={3524:e=>{"use strict";e.exports=require("@prisma/client")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3409:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>c,pages:()=>u,routeModule:()=>h,tree:()=>d}),a(8748),a(596),a(1506),a(5866);var r=a(3191),s=a(8716),n=a(7922),i=a.n(n),l=a(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);a.d(t,o);let d=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,8748)),"/Users/nagai/auto-loop-demo/app/admin/page.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,596)),"/Users/nagai/auto-loop-demo/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,1506)),"/Users/nagai/auto-loop-demo/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}],u=["/Users/nagai/auto-loop-demo/app/admin/page.tsx"],c="/admin/page",m={require:a,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},2817:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,9404,23))},7794:()=>{},2126:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,2994,23)),Promise.resolve().then(a.t.bind(a,6114,23)),Promise.resolve().then(a.t.bind(a,9727,23)),Promise.resolve().then(a.t.bind(a,9671,23)),Promise.resolve().then(a.t.bind(a,1868,23)),Promise.resolve().then(a.t.bind(a,4759,23))},5303:()=>{},963:e=>{e.exports={shell:"layout_shell__VDS2f",sidebar:"layout_sidebar__91DNp",brand:"layout_brand__7r_EQ",brandLink:"layout_brandLink__Us7kf",brandMark:"layout_brandMark__kMwAP",brandText:"layout_brandText__saJb_",nav:"layout_nav__p8J2W",navItem:"layout_navItem___JPGO",navFooter:"layout_navFooter__HYW3U",navHelp:"layout_navHelp__FpSjQ",content:"layout_content__J04gB",header:"layout_header__hf7yS",headerTitle:"layout_headerTitle__rAQ6L",main:"layout_main__9mJd7",panel:"layout_panel__pBuc5"}},596:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var r=a(9510),s=a(7371),n=a(963),i=a.n(n);function l({children:e}){return(0,r.jsxs)("div",{className:i().shell,children:[(0,r.jsxs)("aside",{className:i().sidebar,children:[r.jsx("div",{className:i().brand,children:(0,r.jsxs)(s.default,{href:"/admin",className:i().brandLink,children:[r.jsx("span",{className:i().brandMark,children:"●"}),r.jsx("span",{className:i().brandText,children:"Admin"})]})}),(0,r.jsxs)("nav",{className:i().nav,children:[r.jsx(s.default,{href:"/admin",className:i().navItem,children:"ダッシュボード"}),r.jsx(s.default,{href:"/admin/reservations",className:i().navItem,children:"予約一覧"}),r.jsx(s.default,{href:"/admin/customers",className:i().navItem,children:"顧客一覧"})]})]}),(0,r.jsxs)("div",{className:i().main,children:[(0,r.jsxs)("header",{className:i().header,children:[r.jsx("div",{className:i().headerTitle,children:"管理画面"}),r.jsx("div",{className:i().headerActions})]}),r.jsx("main",{className:i().content,children:e})]})]})}},8748:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var r=a(9510),s=a(3538);function n(e=new Date){let t=new Date(e);return t.setHours(0,0,0,0),t}function i(e=new Date){let t=new Date(e);return t.setHours(23,59,59,999),t}function l(e=new Date){let t=new Date(e),a=t.getDay();return t.setDate(t.getDate()-(a+6)%7),t.setHours(0,0,0,0),t}let o=e=>`\xa5${(e??0).toLocaleString("ja-JP")}`;async function d(){let e=n(),t=i(),a=l(),r=function(e=new Date){let t=l(e),a=new Date(t);return a.setDate(t.getDate()+6),a.setHours(23,59,59,999),a}(),[o,d,u,c]=await Promise.all([s._.reservation.aggregate({_sum:{amount:!0},_count:!0,where:{status:"PAID",createdAt:{gte:e,lte:t}}}),s._.reservation.aggregate({_sum:{amount:!0},_count:!0,where:{status:"PAID",createdAt:{gte:a,lte:r}}}),s._.reservation.groupBy({by:["status"],where:{createdAt:{gte:e,lte:t}},_count:{_all:!0}}),s._.reservation.groupBy({by:["status"],where:{createdAt:{gte:a,lte:r}},_count:{_all:!0}})]),m=e=>e.reduce((e,t)=>(e[t.status]=t._count._all,e),{});return{today:{paidCount:o._count,paidAmount:o._sum.amount??0,byStatus:m(u)},week:{paidCount:d._count,paidAmount:d._sum.amount??0,byStatus:m(c)}}}async function u(){let e=n(),t=new Date(e);t.setDate(e.getDate()-29);let a=await s._.reservation.findMany({where:{status:"PAID",createdAt:{gte:t,lte:i(e)}},select:{amount:!0,createdAt:!0}}),r=new Map;for(let e=0;e<30;e++){let a=new Date(t);a.setDate(t.getDate()+e);let s=a.toISOString().slice(0,10);r.set(s,0)}for(let e of a){let t=new Date(e.createdAt).toISOString().slice(0,10);r.has(t)&&r.set(t,(r.get(t)??0)+(e.amount??0))}return Array.from(r.entries()).map(([e,t])=>({date:e,amount:t}))}function c({series:e}){let t=t=>48+1136*t/Math.max(1,e.length-1),a=Math.max(1,...e.map(e=>e.amount)),s=e=>224-206*e/a,n=e.map((e,a)=>`${t(a)},${s(e.amount)}`).join(" "),i=Array.from({length:5}).map((e,t)=>{let r=a*t/4;return{y:s(r),v:r}}),l=Array.from({length:5}).map((a,r)=>{let s=Math.round((e.length-1)*(r/4)),n=e[s].date.slice(5).replace("-","/");return{x:t(s),label:n}});return r.jsx("div",{style:{width:"100%"},children:(0,r.jsxs)("svg",{viewBox:"0 0 1200 260",preserveAspectRatio:"none",style:{width:"100%",height:260,display:"block"},"aria-label":"売上推移（直近30日）",children:[r.jsx("rect",{x:"0",y:"0",width:1200,height:260,fill:"#ffffff"}),i.map(({y:e},t)=>r.jsx("line",{x1:48,x2:1184,y1:e,y2:e,stroke:"#e5e7eb",strokeWidth:"1"},t)),r.jsx("polyline",{fill:"none",stroke:"#2563eb",strokeWidth:"2.5",points:n}),r.jsx("polyline",{fill:"rgba(37, 99, 235, 0.12)",stroke:"none",points:["48,224",n,"1184,224"].join(" ")}),i.map(({y:e,v:t},a)=>r.jsx("text",{x:40,y:e,textAnchor:"end",dominantBaseline:"middle",fontSize:"11",fill:"#64748b",children:o(Math.round(t))},a)),l.map(({x:e,label:t},a)=>r.jsx("text",{x:e,y:250,textAnchor:0===a?"start":a===l.length-1?"end":"middle",fontSize:"11",fill:"#64748b",children:t},a))]})})}async function m(){let[e,t]=await Promise.all([d(),u()]),a=({title:e,children:t,style:a})=>(0,r.jsxs)("div",{style:{...h.card,...a??{}},children:[r.jsx("div",{style:h.cardTtl,children:e}),r.jsx("div",{children:t})]}),s=({label:e,value:t})=>(0,r.jsxs)("div",{style:h.stat,children:[r.jsx("div",{style:h.statK,children:e}),r.jsx("div",{style:h.statV,children:t})]}),n=e.today.byStatus.CANCELLED??0,i=e.week.byStatus.CANCELLED??0;return(0,r.jsxs)("div",{style:{display:"grid",gap:16},children:[(0,r.jsxs)("div",{style:h.grid,children:[(0,r.jsxs)(a,{title:"本日の売上（確定）",children:[r.jsx(s,{label:"件数",value:`${e.today.paidCount} 件`}),r.jsx(s,{label:"金額",value:o(e.today.paidAmount)})]}),(0,r.jsxs)(a,{title:"今週の売上（確定）",children:[r.jsx(s,{label:"件数",value:`${e.week.paidCount} 件`}),r.jsx(s,{label:"金額",value:o(e.week.paidAmount)})]}),r.jsx(a,{title:"本日のステータス別",children:r.jsx("ul",{style:h.list,children:Object.entries(e.today.byStatus).map(([e,t])=>(0,r.jsxs)("li",{children:[r.jsx("b",{children:e}),": ",t," 件"]},e))})}),(0,r.jsxs)(a,{title:"キャンセル数",children:[r.jsx(s,{label:"本日",value:`${n} 件`}),r.jsx("div",{style:{height:6}}),r.jsx(s,{label:"今週",value:`${i} 件`})]})]}),(0,r.jsxs)("div",{children:[r.jsx("div",{style:{fontWeight:900,margin:"6px 0 10px"},children:"売上推移（直近30日）"}),r.jsx("div",{style:h.chartCard,children:r.jsx(c,{series:t})})]})]})}let h={grid:{display:"grid",gridTemplateColumns:"repeat(4, minmax(220px, 1fr))",gap:16},card:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},cardTtl:{fontWeight:800,marginBottom:8},stat:{display:"grid",gap:4},statK:{color:"#64748b",fontSize:12},statV:{fontWeight:900,fontSize:20},list:{margin:0,paddingLeft:18},chartCard:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:8}}},1506:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var r=a(9510);function s({children:e}){return r.jsx("html",{lang:"ja",children:r.jsx("body",{children:e})})}a(7272)},3538:(e,t,a)=>{"use strict";a.d(t,{_:()=>s});var r=a(3524);let s=global.prisma??new r.PrismaClient({log:["error"]})},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,471,783],()=>a(3409));module.exports=r})();
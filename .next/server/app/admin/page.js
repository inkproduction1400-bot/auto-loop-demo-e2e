(()=>{var e={};e.id=698,e.ids=[698],e.modules={329:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>c,pages:()=>u,routeModule:()=>h,tree:()=>d});var a=r(260),s=r(8203),n=r(5155),i=r.n(n),l=r(7292),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let d={children:["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,5128)),"/Users/nagai/auto-loop-demo/app/admin/page.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,7280)),"/Users/nagai/auto-loop-demo/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,9611)),"/Users/nagai/auto-loop-demo/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,1485,23)),"next/dist/client/components/unauthorized-error"]}]}.children,u=["/Users/nagai/auto-loop-demo/app/admin/page.tsx"],c={require:r,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2636:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,6959,23)),Promise.resolve().then(r.t.bind(r,3875,23)),Promise.resolve().then(r.t.bind(r,8903,23)),Promise.resolve().then(r.t.bind(r,7174,23)),Promise.resolve().then(r.t.bind(r,4178,23)),Promise.resolve().then(r.t.bind(r,7190,23)),Promise.resolve().then(r.t.bind(r,8429,23)),Promise.resolve().then(r.t.bind(r,1365,23))},2704:()=>{},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3751:()=>{},3873:e=>{"use strict";e.exports=require("path")},3921:e=>{e.exports={shell:"layout_shell__VDS2f",sidebar:"layout_sidebar__91DNp",brand:"layout_brand__7r_EQ",brandLink:"layout_brandLink__Us7kf",brandMark:"layout_brandMark__kMwAP",brandText:"layout_brandText__saJb_",nav:"layout_nav__p8J2W",navItem:"layout_navItem___JPGO",navFooter:"layout_navFooter__HYW3U",navHelp:"layout_navHelp__FpSjQ",content:"layout_content__J04gB",header:"layout_header__hf7yS",headerTitle:"layout_headerTitle__rAQ6L",main:"layout_main__9mJd7",panel:"layout_panel__pBuc5"}},4908:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});var a=r(6330);let s=global.prisma??new a.PrismaClient({log:["error"]})},5128:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var a=r(2740),s=r(4908);function n(e=new Date){let t=new Date(e);return t.setHours(0,0,0,0),t}function i(e=new Date){let t=new Date(e);return t.setHours(23,59,59,999),t}function l(e=new Date){let t=new Date(e),r=t.getDay();return t.setDate(t.getDate()-(r+6)%7),t.setHours(0,0,0,0),t}let o=e=>`\xa5${(e??0).toLocaleString("ja-JP")}`;async function d(){let e=n(),t=i(),r=l(),a=function(e=new Date){let t=l(e),r=new Date(t);return r.setDate(t.getDate()+6),r.setHours(23,59,59,999),r}(),[o,d,u,c]=await Promise.all([s.z.reservation.aggregate({_sum:{amount:!0},_count:!0,where:{status:"PAID",createdAt:{gte:e,lte:t}}}),s.z.reservation.aggregate({_sum:{amount:!0},_count:!0,where:{status:"PAID",createdAt:{gte:r,lte:a}}}),s.z.reservation.groupBy({by:["status"],where:{createdAt:{gte:e,lte:t}},_count:{_all:!0}}),s.z.reservation.groupBy({by:["status"],where:{createdAt:{gte:r,lte:a}},_count:{_all:!0}})]),h=e=>e.reduce((e,t)=>(e[t.status]=t._count._all,e),{});return{today:{paidCount:o._count,paidAmount:o._sum.amount??0,byStatus:h(u)},week:{paidCount:d._count,paidAmount:d._sum.amount??0,byStatus:h(c)}}}async function u(){let e=n(),t=new Date(e);t.setDate(e.getDate()-29);let r=await s.z.reservation.findMany({where:{status:"PAID",createdAt:{gte:t,lte:i(e)}},select:{amount:!0,createdAt:!0}}),a=new Map;for(let e=0;e<30;e++){let r=new Date(t);r.setDate(t.getDate()+e);let s=r.toISOString().slice(0,10);a.set(s,0)}for(let e of r){let t=new Date(e.createdAt).toISOString().slice(0,10);a.has(t)&&a.set(t,(a.get(t)??0)+(e.amount??0))}return Array.from(a.entries()).map(([e,t])=>({date:e,amount:t}))}function c({series:e}){let t=t=>48+1136*t/Math.max(1,e.length-1),r=Math.max(1,...e.map(e=>e.amount)),s=e=>224-206*e/r,n=e.map((e,r)=>`${t(r)},${s(e.amount)}`).join(" "),i=Array.from({length:5}).map((e,t)=>{let a=r*t/4;return{y:s(a),v:a}}),l=Array.from({length:5}).map((r,a)=>{let s=Math.round((e.length-1)*(a/4)),n=e[s].date.slice(5).replace("-","/");return{x:t(s),label:n}});return(0,a.jsx)("div",{style:{width:"100%"},children:(0,a.jsxs)("svg",{viewBox:"0 0 1200 260",preserveAspectRatio:"none",style:{width:"100%",height:260,display:"block"},"aria-label":"売上推移（直近30日）",children:[(0,a.jsx)("rect",{x:"0",y:"0",width:1200,height:260,fill:"#ffffff"}),i.map(({y:e},t)=>(0,a.jsx)("line",{x1:48,x2:1184,y1:e,y2:e,stroke:"#e5e7eb",strokeWidth:"1"},t)),(0,a.jsx)("polyline",{fill:"none",stroke:"#2563eb",strokeWidth:"2.5",points:n}),(0,a.jsx)("polyline",{fill:"rgba(37, 99, 235, 0.12)",stroke:"none",points:["48,224",n,"1184,224"].join(" ")}),i.map(({y:e,v:t},r)=>(0,a.jsx)("text",{x:40,y:e,textAnchor:"end",dominantBaseline:"middle",fontSize:"11",fill:"#64748b",children:o(Math.round(t))},r)),l.map(({x:e,label:t},r)=>(0,a.jsx)("text",{x:e,y:250,textAnchor:0===r?"start":r===l.length-1?"end":"middle",fontSize:"11",fill:"#64748b",children:t},r))]})})}async function h(){let[e,t]=await Promise.all([d(),u()]),r=({title:e,children:t,style:r})=>(0,a.jsxs)("div",{style:{...m.card,...r??{}},children:[(0,a.jsx)("div",{style:m.cardTtl,children:e}),(0,a.jsx)("div",{children:t})]}),s=({label:e,value:t})=>(0,a.jsxs)("div",{style:m.stat,children:[(0,a.jsx)("div",{style:m.statK,children:e}),(0,a.jsx)("div",{style:m.statV,children:t})]}),n=e.today.byStatus.CANCELLED??0,i=e.week.byStatus.CANCELLED??0;return(0,a.jsxs)("div",{style:{display:"grid",gap:16},children:[(0,a.jsxs)("div",{style:m.grid,children:[(0,a.jsxs)(r,{title:"本日の売上（確定）",children:[(0,a.jsx)(s,{label:"件数",value:`${e.today.paidCount} 件`}),(0,a.jsx)(s,{label:"金額",value:o(e.today.paidAmount)})]}),(0,a.jsxs)(r,{title:"今週の売上（確定）",children:[(0,a.jsx)(s,{label:"件数",value:`${e.week.paidCount} 件`}),(0,a.jsx)(s,{label:"金額",value:o(e.week.paidAmount)})]}),(0,a.jsx)(r,{title:"本日のステータス別",children:(0,a.jsx)("ul",{style:m.list,children:Object.entries(e.today.byStatus).map(([e,t])=>(0,a.jsxs)("li",{children:[(0,a.jsx)("b",{children:e}),": ",t," 件"]},e))})}),(0,a.jsxs)(r,{title:"キャンセル数",children:[(0,a.jsx)(s,{label:"本日",value:`${n} 件`}),(0,a.jsx)("div",{style:{height:6}}),(0,a.jsx)(s,{label:"今週",value:`${i} 件`})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontWeight:900,margin:"6px 0 10px"},children:"売上推移（直近30日）"}),(0,a.jsx)("div",{style:m.chartCard,children:(0,a.jsx)(c,{series:t})})]})]})}let m={grid:{display:"grid",gridTemplateColumns:"repeat(4, minmax(220px, 1fr))",gap:16},card:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},cardTtl:{fontWeight:800,marginBottom:8},stat:{display:"grid",gap:4},statK:{color:"#64748b",fontSize:12},statV:{fontWeight:900,fontSize:20},list:{margin:0,paddingLeft:18},chartCard:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:8}}},5503:()=>{},6330:e=>{"use strict";e.exports=require("@prisma/client")},6487:()=>{},7280:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var a=r(2740),s=r(9607),n=r.n(s),i=r(3921),l=r.n(i);function o({children:e}){return(0,a.jsxs)("div",{className:l().shell,children:[(0,a.jsxs)("aside",{className:l().sidebar,children:[(0,a.jsx)("div",{className:l().brand,children:(0,a.jsxs)(n(),{href:"/admin",className:l().brandLink,children:[(0,a.jsx)("span",{className:l().brandMark,children:"●"}),(0,a.jsx)("span",{className:l().brandText,children:"Admin"})]})}),(0,a.jsxs)("nav",{className:l().nav,children:[(0,a.jsx)(n(),{href:"/admin",className:l().navItem,children:"ダッシュボード"}),(0,a.jsx)(n(),{href:"/admin/reservations",className:l().navItem,children:"予約一覧"}),(0,a.jsx)(n(),{href:"/admin/customers",className:l().navItem,children:"顧客一覧"})]})]}),(0,a.jsxs)("div",{className:l().main,children:[(0,a.jsxs)("header",{className:l().header,children:[(0,a.jsx)("div",{className:l().headerTitle,children:"管理画面"}),(0,a.jsx)("div",{className:l().headerActions})]}),(0,a.jsx)("main",{className:l().content,children:e})]})]})}},8335:()=>{},9032:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,8531,23))},9084:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,3219,23)),Promise.resolve().then(r.t.bind(r,4863,23)),Promise.resolve().then(r.t.bind(r,5155,23)),Promise.resolve().then(r.t.bind(r,802,23)),Promise.resolve().then(r.t.bind(r,9350,23)),Promise.resolve().then(r.t.bind(r,8530,23)),Promise.resolve().then(r.t.bind(r,1601,23)),Promise.resolve().then(r.t.bind(r,8921,23))},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9304:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,9607,23))},9611:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var a=r(2740);function s({children:e}){return(0,a.jsx)("html",{lang:"ja",children:(0,a.jsx)("body",{children:e})})}r(2704)}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,999,977],()=>r(329));module.exports=a})();
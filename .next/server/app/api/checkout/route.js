"use strict";(()=>{var e={};e.id=607,e.ids=[607],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},1764:e=>{e.exports=require("util")},7852:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>S,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>E,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>l,POST:()=>p});var o=r(9303),a=r(8716),n=r(670),i=r(7070);let u="http://127.0.0.1:3100".replace(/\/+$/,"");function c(e,t=500){return i.NextResponse.json({error:e},{status:t})}async function p(e){let t={};try{t=await e.json()}catch{t={}}let s=Number.isFinite(t?.amount)&&t.amount>0?Math.round(Number(t.amount)):1e3,o=(String(t?.currency??"jpy")||"jpy").toLowerCase(),a=Object.fromEntries(Object.entries({...t?.metadata??{},via:t?.metadata?.via??"api"}).map(([e,t])=>[e,"string"==typeof t?t:JSON.stringify(t)])),n=new URL(e.url);if("1"===process.env.E2E_STRIPE_MOCK||"1"===n.searchParams.get("mock")||"1"===e.headers.get("x-e2e-mock")){let e=(a.outcome||"").toLowerCase(),t=new URLSearchParams({amount:String(s),currency:o,status:"decline"===e||"cancel"===e?"cancel":"success"}),r=`${u}/mock-checkout?${t.toString()}`;return i.NextResponse.json({url:r},{status:200})}let p=process.env.STRIPE_SECRET_KEY??"";if(!p)return c("Missing STRIPE_SECRET_KEY on server",500);let{default:l}=await r.e(787).then(r.bind(r,4787)),d=new l(p);try{let e=await d.checkout.sessions.create({mode:"payment",payment_method_types:["card"],line_items:[{price_data:{currency:o,product_data:{name:"Reservation Fee"},unit_amount:s},quantity:1}],metadata:a,success_url:`${u}/?status=success&session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${u}/?status=cancel`});return i.NextResponse.json({url:e.url},{status:200})}catch(e){return console.error("[Stripe] create session failed:",e?.message??e),c("Stripe create session failed",500)}}async function l(e){return"1"===process.env.E2E_STRIPE_MOCK?i.NextResponse.json({ok:!0,mock:!0}):process.env.STRIPE_SECRET_KEY?i.NextResponse.json({ok:!0,mock:!1}):c("Missing STRIPE_SECRET_KEY on server",500)}let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/checkout/route",pathname:"/api/checkout",filename:"route",bundlePath:"app/api/checkout/route"},resolvedPagePath:"/Users/nagai/auto-loop-demo/app/api/checkout/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:E}=d,_="/api/checkout/route";function S(){return(0,n.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:h})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972],()=>r(7852));module.exports=s})();